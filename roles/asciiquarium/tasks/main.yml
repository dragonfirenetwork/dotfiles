---
# roles/asciiquarium/tasks/main.yml

- name: Asciiquarium | MacOSX | Install asciiquarium
  homebrew:
    name: asciiquarium
    state: present
  when: ansible_os_family == "Darwin"
  tags:
    - asciiquarium

- name: Asciiquarium | Debian-based | Install asciiquarium
  apt:
    name: asciiquarium
    state: present
  when: ansible_os_family == "Debian"
  tags:
    - asciiquarium

- name: Asciiquarium | Check if aliases exist
  shell: grep -q '^# Asciiquarium' "{{ ansible_env.HOME }}/.zshrc"
  ignore_errors: true
  register: aq_aliases

- name: Asciiquarium | Remove old aliases
  lineinfile:
    path: "{{ ansible_env.HOME }}/.zshrc"
    state: absent
    regexp: '^# Asciiquarium(\n|.)*alias aq=asciiquarium'
  when: aq_aliases.rc == 0

- name: Asciiquarium | Add aliases
  lineinfile:
    path: "{{ ansible_env.HOME }}/.zshrc"
    line: |
      # Asciiquarium
      alias brb=asciiquarium
      alias aq=asciiquarium
    state: present
    insertafter: EOF
  tags:
    - asciiquarium